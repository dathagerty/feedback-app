{% extends "base.html" %}

{% block title %}{{ prompt.title }} - Admin{% endblock %}

{% block content %}
<div class="nav">
    <a href="/admin">All Prompts</a>
    <a href="/admin/new">Create New Prompt</a>
</div>

<h1>{{ prompt.title }}</h1>
<p>{{ prompt.description }}</p>
<p class="meta">Created: {{ prompt.created_at }}</p>

<div class="link-box">
    <strong>Share this link to collect feedback:</strong><br><br>
    <code id="feedback-url">{{ feedback_url }}</code>
    <br>
    <button class="btn btn-small copy-btn" onclick="copyToClipboard()">Copy Link</button>
</div>

<h2>Feedback Responses (<span id="feedback-count">{{ feedback_list.len() }}</span>)</h2>

<div id="feedback-container" hx-get="/api/feedback/{{ prompt.id }}" hx-trigger="every 10s" hx-swap="innerHTML">
{% if feedback_list.is_empty() %}
<div class="empty-state">
    <p>No feedback received yet. Share the link above to start collecting responses!</p>
</div>
{% else %}
<div class="feedback-list">
    {% for fb in feedback_list %}
    <div class="feedback-item">
        <div class="content">{{ fb.content }}</div>
        <div class="meta">Submitted: {{ fb.created_at }}</div>
    </div>
    {% endfor %}
</div>
{% endif %}
</div>

<script>
function copyToClipboard() {
    const url = document.getElementById('feedback-url').textContent;
    navigator.clipboard.writeText(url).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => {
            btn.textContent = originalText;
        }, 2000);
    });
}
</script>
{% endblock %}
